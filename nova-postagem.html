<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Nova Postagem - Intranet do Gringo</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" />
  <style>
    #editor { min-height: 250px; border:1px solid #ccc; padding:10px; border-radius:4px; background:white; overflow-y:auto;}
    #editor:focus { outline:2px solid #09679c; }
    .toolbar button { background:#09679c;color:white;border:none;padding:6px 10px;border-radius:4px;cursor:pointer;margin-right:4px; }
    .toolbar button:hover { background:#074d6b; }
    .toolbar select { padding:5px; border-radius:4px; border:1px solid #ccc; margin-right:8px; }
    .emoji-picker { max-height:120px; overflow-y:scroll; border:1px solid #ccc; background:white; border-radius:4px; padding:5px; display:flex; flex-wrap:wrap; gap:6px; margin-top:6px; }
    .emoji-picker span { cursor:pointer; font-size:20px; }
  </style>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col">

<header class="flex justify-between items-center bg-[#09679c] text-white p-4 shadow-md">
  <div class="flex items-center gap-3">
    <img src="img/logo.png" alt="Logo Gringo" class="h-10 w-auto" />
    <h1 class="text-xl font-bold">Nova Postagem</h1>
  </div>
  <nav id="mainMenu" class="flex items-center gap-3"></nav>
</header>

<main class="flex-grow max-w-4xl mx-auto p-6">
  <form id="formPostagem" class="bg-white rounded shadow p-6 space-y-6">
    <div id="msgSucesso" class="text-center font-semibold mb-4"></div>
    
    <div>
      <label for="titulo" class="block font-semibold mb-1 text-gray-700">Título</label>
      <input type="text" id="titulo" name="titulo"
        class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[#09679c]"
        placeholder="Digite o título da postagem" required />
    </div>

    <div>
      <label class="block font-semibold mb-1 text-gray-700">Conteúdo</label>
      <div class="toolbar mb-2 flex flex-wrap items-center gap-1">
        <button type="button" onclick="format('bold')"><i class="fas fa-bold"></i></button>
        <button type="button" onclick="format('italic')"><i class="fas fa-italic"></i></button>
        <button type="button" onclick="format('underline')"><i class="fas fa-underline"></i></button>
        <select onchange="format('fontName', this.value)">
          <option value="Arial">Arial</option>
          <option value="Courier New">Courier New</option>
          <option value="Georgia">Georgia</option>
          <option value="Tahoma">Tahoma</option>
          <option value="Times New Roman">Times New Roman</option>
          <option value="Verdana">Verdana</option>
        </select>
        <select onchange="format('fontSize', this.value)">
          <option value="1">10px</option>
          <option value="2">13px</option>
          <option value="3" selected>16px</option>
          <option value="4">18px</option>
          <option value="5">24px</option>
          <option value="6">32px</option>
          <option value="7">48px</option>
        </select>
        <button type="button" onclick="format('insertUnorderedList')"><i class="fas fa-list-ul"></i></button>
        <button type="button" onclick="format('insertOrderedList')"><i class="fas fa-list-ol"></i></button>
        <button type="button" onclick="inserirLink()"><i class="fas fa-link"></i></button>
        <input type="file" id="inputImagem" accept="image/*" style="display:none" onchange="inserirImagem(event)" />
        <button type="button" onclick="document.getElementById('inputImagem').click()"><i class="fas fa-image"></i></button>
        <button type="button" onclick="toggleEmojiPicker()"><i class="fas fa-smile"></i></button>
      </div>
      <div id="emojiPicker" class="emoji-picker hidden"></div>
      <div id="editor" contenteditable="true" spellcheck="true" class="prose max-w-none"></div>
      <input type="hidden" id="conteudo" name="conteudo">
    </div>

    <div class="flex gap-3">
      <button type="submit" name="tipo" value="rascunho" class="bg-yellow-600 hover:bg-yellow-700 text-white font-semibold px-6 py-2 rounded">Salvar Rascunho</button>
      <button type="submit" name="tipo" value="publicar" class="bg-green-600 hover:bg-green-700 text-white font-semibold px-6 py-2 rounded">Publicar</button>
    </div>
  </form>
</main>

<!-- SCRIPTS SEPARADOS -->
<script src="editor.js"></script>
<script src="publicar.js"></script>
<script>
window.onload = () => {
  const usuarioLogado = localStorage.getItem("usuarioLogado");
  const usuariosAutorizados = ["gabriel.amaral","graziele.albuquerque","karina.maia","cristiano.santos","gilvaniogringo"];

  if(!usuarioLogado || !usuariosAutorizados.includes(usuarioLogado)) {
    alert("Acesso negado.");
    window.location.href = "intranet.html";
    return;
  }

  montarMenu();
  popularEmojis();
  initPublicacao(); // inicializa submit com rascunho/publicar separado
};
</script>
</body>
</html>
