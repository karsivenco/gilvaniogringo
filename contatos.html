<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Contato - Intranet do Gringo</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
</head>
<body class="bg-gray-100 flex">

  <!-- Menu superior fixo -->
  <header class="fixed top-0 left-0 w-full bg-[#09679c] text-white p-4 shadow-md z-50 flex justify-between items-center">
    <div class="flex items-center gap-3">
      <img src="img/logo.png" alt="Logo Gringo" class="h-10 w-auto" />
      <h1 class="text-xl font-bold">Contato</h1>
    </div>
    <nav id="mainMenu" class="flex items-center gap-3"></nav>
  </header>

  <!-- Menu lateral fixo -->
  <aside class="bg-[#09679c] w-64 p-6 text-white flex flex-col gap-4 fixed top-16 h-[calc(100vh-4rem)]">
    <h2 class="font-bold text-lg border-b border-white pb-2">CONTATO</h2>
    <button onclick="mostrarAba('dadosPessoais')" class="text-left hover:underline">Eleitores</button>
    <button onclick="mostrarAba('aniversario')" class="text-left hover:underline">Aniversário</button>
    <button onclick="mostrarAba('mensagens')" class="text-left hover:underline">Mensagens Prontas</button>
    <button onclick="mostrarAba('listaTransmissao')" class="text-left hover:underline">Lista de Transmissão</button>
  </aside>

  <!-- Área principal -->
  <main class="flex-1 ml-64 pt-24 p-6 overflow-y-auto">

    <!-- Eleitores -->
    <div id="dadosPessoais" class="aba bg-white text-black shadow rounded-lg p-6 hidden">
      <h3 class="text-xl font-bold mb-4">Eleitores</h3>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4 items-end">
        <div class="relative">
          <input type="text" id="pesquisarNome" placeholder="Pesquisar Nome" class="p-2 rounded border border-gray-300 w-full"/>
          <i class="fas fa-search absolute right-2 top-2.5 text-gray-400"></i>
        </div>
        <select id="municipio" class="p-2 rounded border border-gray-300">
          <option value="">Selecione o Município</option>
        </select>
        <select id="bairro" class="p-2 rounded border border-gray-300 hidden">
          <option value="">Selecione o Bairro</option>
        </select>
        <button onclick="buscarEleitor()" class="col-span-1 md:col-span-3 bg-[#09679c] text-white px-4 py-2 rounded hover:bg-[#074d6b] transition">Pesquisar</button>
      </div>
      <div id="resultadoPesquisa" class="mt-4 grid grid-cols-1 gap-3">
        <p>Nenhum eleitor pesquisado ainda.</p>
      </div>
    </div>

    <!-- Aniversário -->
    <div id="aniversario" class="aba bg-white text-black shadow rounded-lg p-6 hidden">
      <h3 class="text-xl font-bold mb-4">Aniversário</h3>
      <div id="aniversariantesMes" class="grid grid-cols-2 md:grid-cols-4 gap-2 mb-4"></div>
      <ul id="listaAniversariantes" class="list-disc pl-6 mb-4">
        <li class="text-gray-500 italic">Clique em um mês para ver os aniversariantes.</li>
      </ul>
      <img src="img/aniversario.png" alt="Imagem Aniversário" class="w-full md:w-1/2 mx-auto mt-4"/>
    </div>

    <!-- Mensagens Prontas -->
    <div id="mensagens" class="aba bg-white text-black shadow rounded-lg p-6 hidden">
      <h3 class="text-xl font-bold mb-4">Mensagens Prontas</h3>
      <div class="mb-4">
        <label for="mensagemMunicipio" class="block font-medium mb-1">Enviar por Município:</label>
        <select id="mensagemMunicipio" class="p-2 rounded border border-gray-300 w-full md:w-1/3">
          <option value="">Selecione o Município</option>
        </select>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4" id="containerMensagens"></div>
    </div>

    <!-- Lista de Transmissão -->
    <div id="listaTransmissao" class="aba bg-white text-black shadow rounded-lg p-6 hidden">
      <h3 class="text-xl font-bold mb-4">Lista de Transmissão</h3>
      <div id="listaPorMunicipio">
        <p>Nenhuma lista de transmissão cadastrada.</p>
      </div>
    </div>

  </main>

  <!-- JS separados -->
  <script src="menu.js"></script>
  <script src="municipios.js"></script>
  <script src="bairros.js"></script>
  <script src="mensagens.js"></script>
  <script src="transmissao.js"></script>

  <!-- Script local -->
  <script>
    const meses = [
      "Janeiro","Fevereiro","Março","Abril","Maio","Junho",
      "Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"
    ];

    function mostrarAba(id) {
      document.querySelectorAll('.aba').forEach(div => div.classList.add('hidden'));
      const aba = document.getElementById(id);
      if (aba) aba.classList.remove('hidden');
    }

    function popularSelect(id, lista) {
      const select = document.getElementById(id);
      select.length = 1;
      lista.forEach(item => {
        const option = document.createElement('option');
        option.value = item;
        option.textContent = item;
        select.appendChild(option);
      });
    }

    function pegarClientes() {
      return JSON.parse(localStorage.getItem('clientes')) || [];
    }

    function salvarClientes(clientes) {
      localStorage.setItem('clientes', JSON.stringify(clientes));
    }

    function montarCalendario() {
      const container = document.getElementById("aniversariantesMes");
      container.innerHTML = "";
      meses.forEach((mes) => {
        const count = pegarClientes().filter(c => c.mesAniversario === mes).length;
        const div = document.createElement("div");
        div.className = "bg-gray-100 p-3 rounded text-center cursor-pointer hover:bg-gray-200";
        div.innerHTML = `<strong>${mes}</strong><br>${count} pessoa(s)`;
        div.onclick = () => mostrarAniversariantesMes(mes);
        container.appendChild(div);
      });
    }

    function mostrarAniversariantesMes(mes) {
      const lista = document.getElementById("listaAniversariantes");
      lista.innerHTML = "";
      const clientes = pegarClientes().filter(c => c.mesAniversario === mes);
      if (clientes.length === 0) {
        lista.innerHTML = '<li class="py-2 text-gray-500 italic">Nenhum aniversariante neste mês.</li>';
        return;
      }
      clientes.forEach((c, index) => {
        const li = document.createElement("li");
        li.className = "py-2 flex justify-between items-center";
        li.innerHTML = `
          <span><strong>${c.nome}</strong> - ${c.municipio} - ${c.bairro || ''} - ${c.numero || ''} - ${c.endereco || ''}</span>
          <div class="flex gap-2">
            <a href="base.html?id=${index}" class="bg-[#09679c] text-white px-2 py-1 rounded hover:bg-[#074d6b]">Abrir ficha</a>
            <button onclick="enviarMensagem(${index})" class="bg-green-600 text-white px-2 py-1 rounded hover:bg-green-700">Enviar</button>
          </div>
        `;
        lista.appendChild(li);
      });
    }

    function enviarMensagem(index) {
      const cliente = pegarClientes()[index];
      if (!cliente) return;
      alert(`Mensagem enviada para ${cliente.nome} (${cliente.numero})!`);
    }

    function carregarClientes() {
      const clientes = pegarClientes();
      const selectMun = document.getElementById('municipio');
      const selectMens = document.getElementById('mensagemMunicipio');
      if (typeof municipios !== "undefined") {
        popularSelect('municipio', municipios);
        if(selectMens) popularSelect('mensagemMunicipio', municipios);
      }
      if(selectMens) {
        selectMens.innerHTML = '<option value="">Selecione o Município</option>';
        const municipiosUnicos = [...new Set(clientes.map(c => c.municipio))];
        municipiosUnicos.forEach(m => {
          const option = document.createElement('option');
          option.value = m;
          option.textContent = m;
          selectMens.appendChild(option);
        });
      }
    }

    function buscarEleitor() {
      const nome = document.getElementById('pesquisarNome').value.toLowerCase();
      const municipio = document.getElementById('municipio').value;
      const resultadoDiv = document.getElementById('resultadoPesquisa');
      resultadoDiv.innerHTML = '';
      let clientes = pegarClientes();
      const filtrados = clientes.filter(c => 
        (!municipio || c.municipio === municipio) &&
        (!nome || c.nome.toLowerCase().includes(nome))
      );
      if (filtrados.length === 0) {
        resultadoDiv.innerHTML = '<p>Nenhum eleitor encontrado.</p>';
        return;
      }
      filtrados.forEach((c, index) => {
        const li = document.createElement('div');
        li.className = 'bg-gray-100 p-3 rounded shadow flex justify-between items-center';
        li.innerHTML = `
          <span><strong>${c.nome}</strong> - ${c.municipio}${c.bairro ? ' - ' + c.bairro : ''} - ${c.numero || ''} - ${c.origem || ''}</span>
          <div class="flex gap-2">
            <a href="base.html?id=${index}" class="bg-[#09679c] text-white px-2 py-1 rounded hover:bg-[#074d6b]">Abrir ficha</a>
            <button onclick="excluirEleitor(${index})" class="bg-red-600 text-white px-2 py-1 rounded hover:bg-red-700">Excluir</button>
          </div>
        `;
        resultadoDiv.appendChild(li);
      });
    }

    function excluirEleitor(index) {
      let clientes = pegarClientes();
      const confirmacao = confirm(`Deseja realmente excluir ${clientes[index].nome}?`);
      if (!confirmacao) return;
      clientes.splice(index, 1);
      salvarClientes(clientes);
      buscarEleitor();
      montarCalendario();
    }

    document.addEventListener("DOMContentLoaded", () => {
      carregarClientes();
      montarCalendario();
      mostrarAba('dadosPessoais');
    });
  </script>

</body>
</html>
